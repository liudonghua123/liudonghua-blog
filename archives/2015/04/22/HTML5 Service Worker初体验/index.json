{"summary":"<p>Chrome 42稳定版发布了！根据Chrome博客公布的消息主要对包括新应用、扩展和包括Push API在内的Web Platform APIs进行重要改善，最大的亮点无疑是本地推送通知，只要得到用户许可，即使Chrome浏览器已经关闭，消息也可以推送给用户。</p>\n<a id=\"more\"></a>\n<p>这个功能是不是很酷！！！<br>这里面就用到了Service worker这个HTML5的新东西，看上去是不是和Web worker有些类似，来看看别人是怎么说的</p>\n<blockquote>\n<p>Service Worker是基于Web Worker的事件驱动的，他们执行的机制都是新开一个线程去处理一些额外的，以前不能直接处理的任务。对于Web Worker，我们可以使用它来进行复杂的计算，因为它并不阻塞浏览器主线程的渲染。而Service Worker，我们可以用它来进行本地缓存，相当于一个本地的proxy</p>\n<h2 id=\"What-are-service-workers\"><a href=\"#What-are-service-workers\" class=\"headerlink\" title=\"What are service workers?\"></a>What are service workers?</h2><p>It’s a new API to enable offline Web apps. (Like AppCache but that doesn’t suck.)<br>看一个来自serviceworker.org的简单例子吧！<br>/index.html</p>\n</blockquote>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span> <span class=\"attr\">lang</span>=<span class=\"string\">\"en\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"utf-8\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span>&gt;</span><span class=\"undefined\"></span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"comment\">// scope defaults to \"/*\"</span></span></span><br><span class=\"line\"><span class=\"javascript\">        navigator.serviceWorker.register(<span class=\"string\">\"/service-worker.js\"</span>).then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">serviceWorker</span>) </span>&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"built_in\">console</span>.log(<span class=\"string\">\"success!\"</span>);</span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"comment\">// To use the serviceWorker immediately,</span></span></span><br><span class=\"line\"><span class=\"javascript\">            <span class=\"comment\">// you might call window.location.reload()</span></span></span><br><span class=\"line\"><span class=\"undefined\">        &#125;);</span></span><br><span class=\"line\"><span class=\"undefined\">    </span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>/service-worker.js</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">this</span>.oninstall = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// Create a cache of resources.</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> resources = <span class=\"keyword\">new</span> Cache();</span><br><span class=\"line\">    <span class=\"keyword\">var</span> visited = <span class=\"keyword\">new</span> Cache();</span><br><span class=\"line\">    <span class=\"comment\">// Fetch them.</span></span><br><span class=\"line\">    e.waitUntil(resources.add(</span><br><span class=\"line\">        <span class=\"string\">\"/index.html\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"/fallback.html\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"/css/base.css\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"/js/app.js\"</span>,</span><br><span class=\"line\">        <span class=\"string\">\"/img/logo.png\"</span></span><br><span class=\"line\">    ).then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// Add caches to the global caches.</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">Promise</span>.all([</span><br><span class=\"line\">            caches.set(<span class=\"string\">\"v1\"</span>, resources),</span><br><span class=\"line\">            caches.set(<span class=\"string\">\"visited\"</span>, visited)</span><br><span class=\"line\">        ]);</span><br><span class=\"line\">    &#125;));</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">this</span>.onfetch = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">    e.respondWith(</span><br><span class=\"line\">        <span class=\"comment\">// Check to see if request is found in cache</span></span><br><span class=\"line\">        caches.match(e.request).catch(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"comment\">// It's not? Prime the cache and return the response.</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> caches.get(<span class=\"string\">\"visited\"</span>).then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">visited</span>) </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> fetch(e.request).then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">response</span>) </span>&#123;</span><br><span class=\"line\">                    visited.put(e.request, response);</span><br><span class=\"line\">                    <span class=\"comment\">// Don't bother waiting, respond already.</span></span><br><span class=\"line\">                    <span class=\"keyword\">return</span> response;</span><br><span class=\"line\">                &#125;);</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">        &#125;).catch(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"comment\">// Connection is down? Simply fallback to a pre-cached page.</span></span><br><span class=\"line\">            <span class=\"keyword\">return</span> caches.match(<span class=\"string\">\"/fallback.html\"</span>);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    );</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>从<a href=\"https://jakearchibald.github.io/isserviceworkerready/\" target=\"_blank\" rel=\"noopener\">这里</a>可以了解到还是Chrome 40+对Service Worker支持的比较完善！<br><a href=\"/resources/2015/04/Is-ServiceWorker-ready.jpg\"><img src=\"/resources/2015/04/Is-ServiceWorker-ready.jpg\" alt=\"Is ServiceWorker ready\"></a></p>\n<p>参考资料<br><a href=\"http://www.foreverpx.cn/2014/09/28/%E5%88%9D%E8%AF%86ServiceWorker/\" target=\"_blank\" rel=\"noopener\">初识ServiceWorker</a><br><a href=\"http://www.w3.org/2014/Talks/0825-xiaoqian-offline/#/\" target=\"_blank\" rel=\"noopener\">游戏规则改变者 Service Worker</a><br><a href=\"http://updates.html5rocks.com/2015/03/push-notificatons-on-the-open-web\" target=\"_blank\" rel=\"noopener\">Push Notifications on the Open Web</a><br><a href=\"http://www.w3.org/TR/2014/WD-service-workers-20140508/#introduction\" target=\"_blank\" rel=\"noopener\">W3C Service Workers Draft</a><br><a href=\"http://www.serviceworker.org/#\" target=\"_blank\" rel=\"noopener\">serviceworker.org</a><br><a href=\"http://www.chinaw3c.org/archives/575/\" target=\"_blank\" rel=\"noopener\">W3C HTML5中文兴趣小组技术分享: ECMAScript 6规范导读</a><br><a href=\"https://github.com/sandropaganotti/service-worker-wiki\" target=\"_blank\" rel=\"noopener\">service-worker-wiki</a><br><a href=\"https://github.com/w3c-webmob/ServiceWorkersDemos\" target=\"_blank\" rel=\"noopener\">ServiceWorkersDemos</a></p>\n"}