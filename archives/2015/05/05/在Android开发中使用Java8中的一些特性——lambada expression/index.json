{"summary":"<p>最近在学习Java8的一些新特性，感觉有很多非常实用的东西，如lambada expression，function interface、stream、property、binding等等，如果可以把这些特性（还有Java7的一些特性如try-resources-catch、Files/Path API）带入到Android开发中，那开发效率就会提高不少！</p>\n<a id=\"more\"></a>\n<p>所以上网查了一下在Android开发中是否可以用Java8的一些特性，Android虽然主要使用Java语言开发，但其运行时的库和Java SE里的不一样，只是两者的API设计几乎一模一样，从Android 4.4开始Android才开始支持Java7，但Android自己的Java类库并没有完全实现Java SE 7。<br>所以如果想让使用了Java8的一些特性的代码在Java6、7下运行，一般是使用Java8编译，然后修改字节码转换成Java6、7的格式或使用低版本实现高版本的特性。</p>\n<p><a href=\"https://github.com/orfjackal/retrolambda#getting-started\" target=\"_blank\" rel=\"noopener\">retrolambda</a>是一个运行Java 8带有lambada表达式在Java7或更低版本的类库<br><a href=\"https://github.com/evant/gradle-retrolambda\" target=\"_blank\" rel=\"noopener\">gradle-retrolambda</a>是一个封装了以上类库提供的一个gradle插件</p>\n<p>我们今天的主题就是使用<a href=\"https://github.com/evant/gradle-retrolambda\" target=\"_blank\" rel=\"noopener\">gradle-retrolambda</a>来实现在Android代码里实现lambada表达式<br><a href=\"http://stackoverflow.com/questions/23318109/is-it-possible-to-use-java-8-for-android-development\" target=\"_blank\" rel=\"noopener\">这里</a>参考了怎样在eclipse中使用，配置有些麻烦，但验证是可行的。<br>请仔细参考原文，这里只是提供几个优化过的脚本以及配置文件，可以在最新的ADT下运行。</p>\n<p>gradle_build.cmd<br><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@echo off</span><br><span class=\"line\">echo Starting the build %1 process...</span><br><span class=\"line\">gradle assembleDebug</span><br><span class=\"line\">pause</span><br></pre></td></tr></table></figure></p>\n<p>gradle_clean.cmd<br><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@echo off</span><br><span class=\"line\">echo Cleaning the %1 project...</span><br><span class=\"line\">gradle clean</span><br><span class=\"line\">pause</span><br></pre></td></tr></table></figure></p>\n<p>gradle_post_build.cmd<br><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@echo off</span><br><span class=\"line\"></span><br><span class=\"line\">if exist build\\outputs\\apk\\%1-debug-unaligned.apk (</span><br><span class=\"line\">\tcopy AndroidManifest.xml bin\\AndroidManifest.xml</span><br><span class=\"line\">\tcopy build\\outputs\\apk\\%1-debug-unaligned.apk bin\\%1.apk</span><br><span class=\"line\">) else (</span><br><span class=\"line\">\techo Build project %1 error. Check the problems window for details...</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure></p>\n<p>builder配置如下图所示<br><a href=\"/resources/2015/05/eclipse_android_gradle.png\"><img src=\"/resources/2015/05/eclipse_android_gradle.png\" alt=\"eclipse_android_gradle\">\n</a></p>\n<p>原文中提供的build.gradle有些陈旧，这里提供一个较新的<br>build.gradle<br><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">buildscript &#123;</span><br><span class=\"line\">    repositories &#123;</span><br><span class=\"line\">        mavenCentral()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    dependencies &#123;</span><br><span class=\"line\">        classpath <span class=\"string\">'com.android.tools.build:gradle:1.1.0'</span></span><br><span class=\"line\">     \tclasspath <span class=\"string\">'me.tatarka:gradle-retrolambda:3.1.0'</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Required because retrolambda is on maven central</span></span><br><span class=\"line\">repositories &#123;</span><br><span class=\"line\">  mavenCentral()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">apply plugin: <span class=\"string\">'android'</span></span><br><span class=\"line\">apply plugin: <span class=\"string\">'me.tatarka.retrolambda'</span></span><br><span class=\"line\"></span><br><span class=\"line\">dependencies &#123;</span><br><span class=\"line\">    <span class=\"function\">compile <span class=\"title\">fileTree</span><span class=\"params\">(dir: <span class=\"string\">'libs'</span>, include: <span class=\"string\">'*.jar'</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">    compile 'com.jakewharton:butterknife:6.1.0'</span></span><br><span class=\"line\"><span class=\"function\">&#125;</span></span><br><span class=\"line\"><span class=\"function\"></span></span><br><span class=\"line\"><span class=\"function\">task <span class=\"title\">wrapper</span><span class=\"params\">(type: Wrapper)</span> </span>&#123;</span><br><span class=\"line\">    gradleVersion = <span class=\"string\">'2.3'</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">android &#123;</span><br><span class=\"line\">    compileSdkVersion <span class=\"number\">22</span></span><br><span class=\"line\">    buildToolsVersion <span class=\"string\">'21.0.2'</span></span><br><span class=\"line\"></span><br><span class=\"line\">    sourceSets &#123;</span><br><span class=\"line\">        main &#123;</span><br><span class=\"line\">            manifest.srcFile <span class=\"string\">'AndroidManifest.xml'</span></span><br><span class=\"line\">            java.srcDirs = [<span class=\"string\">'src'</span>]</span><br><span class=\"line\">            resources.srcDirs = [<span class=\"string\">'src'</span>]</span><br><span class=\"line\">            aidl.srcDirs = [<span class=\"string\">'src'</span>]</span><br><span class=\"line\">            renderscript.srcDirs = [<span class=\"string\">'src'</span>]</span><br><span class=\"line\">            res.srcDirs = [<span class=\"string\">'res'</span>]</span><br><span class=\"line\">            assets.srcDirs = [<span class=\"string\">'assets'</span>]</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Move the tests to tests/java, tests/res, etc...</span></span><br><span class=\"line\">        instrumentTest.setRoot(<span class=\"string\">'tests'</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Move the build types to build-types/&lt;type&gt;</span></span><br><span class=\"line\">        <span class=\"comment\">// For instance, build-types/debug/java, build-types/debug/AndroidManifest.xml, ...</span></span><br><span class=\"line\">        <span class=\"comment\">// This moves them out of them default location under src/&lt;type&gt;/... which would</span></span><br><span class=\"line\">        <span class=\"comment\">// conflict with src/ being used by the main source set.</span></span><br><span class=\"line\">        <span class=\"comment\">// Adding new build types or product flavors should be accompanied</span></span><br><span class=\"line\">        <span class=\"comment\">// by a similar customization.</span></span><br><span class=\"line\">        debug.setRoot(<span class=\"string\">'build-types/debug'</span>)</span><br><span class=\"line\">        release.setRoot(<span class=\"string\">'build-types/release'</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>如果使用的是Android Studio几乎就不需要什么多余的操作，只需要在build.gradle中添加classpath ‘me.tatarka:gradle-retrolambda:3.1.0’的dependence以及apply plugin: ‘me.tatarka.retrolambda’即可</p>\n<p>这里之所以想在Android中使用Java8中lambada表达式是因为有时候在一些需要使用反射的情况下，可以使用lambada改善一下运行效率，即使在Java SE中也比MethodHandler的效率好，可参考<a href=\"http://stackoverflow.com/questions/19557829/faster-alternatives-to-javas-reflection\" target=\"_blank\" rel=\"noopener\">faster-alternatives-to-javas-reflection</a>、<a href=\"https://vaskoz.wordpress.com/2013/07/15/is-java-reflection-slow/\" target=\"_blank\" rel=\"noopener\">is-java-reflection-slow</a></p>\n"}