{"summary":"<p>有时自己的服务器通过ajax请求其他服务器资源时通常会遇到跨域请求（<a href=\"http://www.w3.org/TR/cors/\" target=\"_blank\" rel=\"noopener\">CROS</a>）问题，这有很多解决方式，如使用IE的<a href=\"http://msdn.microsoft.com/en-us/library/ie/dd573303(v=vs.85\" target=\"_blank\" rel=\"noopener\">XDomainRequest</a>.aspx)替代XMLHttpRequest（不跨平台），使用JSON+callback(即JSONP，只能支持json格式数据)，还有一些其他的。。。</p>\n<a id=\"more\"></a>\n<p>并且注意什么是跨域，如liudonghua.com/some_path访问www.liudonghua.com/other_path或liudonghua.com:port_num/yet_another_path都是属于跨域请求，打开浏览器上的JS Console，如果看到如”XMLHttpRequest cannot load <a href=\"http://liudonghua.com:8080/simpleweb/users\" target=\"_blank\" rel=\"noopener\">http://liudonghua.com:8080/simpleweb/users</a>. No ‘Access-Control-Allow-Origin’ header is present on the requested resource. Origin ‘<a href=\"http://liudonghua.com\" target=\"_blank\" rel=\"noopener\">http://liudonghua.com</a>‘ is therefore not allowed access.”错误，那就说明你遇到跨域请求问题了！<br>这里要实现的是一种在自己原始资源服务器上添加”Access-Control-Allow-Origin”等请求头，然后在客户端的ajax请求中设置”options.crossDomain = true;”(这一步是非常必要的，我当时忘了做这一步，结果客户端只发送preflight的options请求，接下来的GET/POST/PUT/DELETE请求没发送)。<br>可参考我写的一个小<a href=\"https://github.com/liudonghua123/simpleweb\" target=\"_blank\" rel=\"noopener\">Demo</a><br>注意以下高亮显示的代码</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.liudonghua.tutorials.simpleweb.controller;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.BufferedReader;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.InputStream;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.InputStreamReader;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.PrintWriter;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.List;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Map;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.regex.Matcher;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.regex.Pattern;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.servlet.ServletException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.servlet.http.HttpServlet;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class=\"line\"><span class=\"keyword\">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> net.sf.json.JSONArray;</span><br><span class=\"line\"><span class=\"keyword\">import</span> net.sf.json.JSONObject;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.liudonghua.tutorials.simpleweb.dao.UserDao;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.liudonghua.tutorials.simpleweb.dao.UserDaoImpl;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.liudonghua.tutorials.simpleweb.model.User;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Servlet implementation class UserController</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UserController</span> <span class=\"keyword\">extends</span> <span class=\"title\">HttpServlet</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"keyword\">long</span> serialVersionUID = <span class=\"number\">1L</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> Pattern regexpAllPattern = Pattern.compile(<span class=\"string\">\"/users\"</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> Pattern regexpSinglePattern = Pattern.compile(<span class=\"string\">\"/users/([0-9]+)\"</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">private</span> Pattern regexpUserStatisticsPattern = Pattern.compile(<span class=\"string\">\"/users/statistics\"</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">private</span> UserDao userDao = <span class=\"keyword\">new</span> UserDaoImpl();</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">boolean</span> <span class=\"title\">isUserStatisticsRequest</span><span class=\"params\">(HttpServletRequest request)</span> </span>&#123;</span><br><span class=\"line\">\t\tMatcher matcher;</span><br><span class=\"line\">\t\tString pathInfo = getPathInfo(request);</span><br><span class=\"line\">\t\tmatcher = regexpUserStatisticsPattern.matcher(pathInfo);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (matcher.find()) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">private</span> <span class=\"keyword\">int</span> <span class=\"title\">isSingleUserInfoRequest</span><span class=\"params\">(HttpServletRequest request)</span> </span>&#123;</span><br><span class=\"line\">\t\tMatcher matcher;</span><br><span class=\"line\">\t\tString pathInfo = getPathInfo(request);</span><br><span class=\"line\">\t\tmatcher = regexpSinglePattern.matcher(pathInfo);</span><br><span class=\"line\">\t\t<span class=\"keyword\">int</span> id = -<span class=\"number\">1</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (matcher.find()) &#123;</span><br><span class=\"line\">\t\t\tid = Integer.parseInt(matcher.group(<span class=\"number\">1</span>));</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\tmatcher = regexpAllPattern.matcher(pathInfo);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (matcher.find()) &#123;</span><br><span class=\"line\">\t\t\t\tid = <span class=\"number\">0</span>;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> id;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">private</span> String <span class=\"title\">getPathInfo</span><span class=\"params\">(HttpServletRequest request)</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">//\t\tString pathInfo = request.getPathInfo();</span></span><br><span class=\"line\">\t\t\t\tString requestURI = request.getRequestURI();</span><br><span class=\"line\">\t\t\t\tString contextPath = request.getContextPath();</span><br><span class=\"line\">\t\t\t\tString pathInfo = requestURI.substring(requestURI.lastIndexOf(contextPath) + contextPath.length());</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> pathInfo;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> String <span class=\"title\">getBody</span><span class=\"params\">(HttpServletRequest request)</span> <span class=\"keyword\">throws</span> IOException </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tString body = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">\t\tStringBuilder stringBuilder = <span class=\"keyword\">new</span> StringBuilder();</span><br><span class=\"line\">\t\tBufferedReader bufferedReader = <span class=\"keyword\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\tInputStream inputStream = request.getInputStream();</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (inputStream != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\t\tbufferedReader = <span class=\"keyword\">new</span> BufferedReader(<span class=\"keyword\">new</span> InputStreamReader(</span><br><span class=\"line\">\t\t\t\t\t\tinputStream));</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">char</span>[] charBuffer = <span class=\"keyword\">new</span> <span class=\"keyword\">char</span>[<span class=\"number\">128</span>];</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">int</span> bytesRead = -<span class=\"number\">1</span>;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">while</span> ((bytesRead = bufferedReader.read(charBuffer)) &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">\t\t\t\t\tstringBuilder.append(charBuffer, <span class=\"number\">0</span>, bytesRead);</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t\tstringBuilder.append(<span class=\"string\">\"\"</span>);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">catch</span> (IOException ex) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">throw</span> ex;</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">finally</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (bufferedReader != <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">\t\t\t\t\tbufferedReader.close();</span><br><span class=\"line\">\t\t\t\t&#125; <span class=\"keyword\">catch</span> (IOException ex) &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">throw</span> ex;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tbody = stringBuilder.toString();</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> body;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@see</span> HttpServlet#doGet(HttpServletRequest request, HttpServletResponse</span></span><br><span class=\"line\"><span class=\"comment\">\t *      response)</span></span><br><span class=\"line\"><span class=\"comment\">\t */</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">doGet</span><span class=\"params\">(HttpServletRequest request,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t\t\tHttpServletResponse response)</span> <span class=\"keyword\">throws</span> ServletException, IOException </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// set HTTP ContentType header of \"application/json\"</span></span><br><span class=\"line\">\t\tresponse.setContentType(<span class=\"string\">\"application/json\"</span>);</span><br><span class=\"line\">\t\tresponse.addHeader(<span class=\"string\">\"Access-Control-Allow-Origin\"</span>, <span class=\"string\">\"*\"</span>);</span><br><span class=\"line\">\t\tPrintWriter out = response.getWriter();</span><br><span class=\"line\">\t\t<span class=\"keyword\">boolean</span> isUserStatisticsRequest = isUserStatisticsRequest(request);</span><br><span class=\"line\">\t\t<span class=\"keyword\">int</span> id = isSingleUserInfoRequest(request);</span><br><span class=\"line\">\t\t<span class=\"comment\">// request user statistics info</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (isUserStatisticsRequest) &#123;</span><br><span class=\"line\">\t\t\tMap&lt;String,String&gt; statisticsInfo = userDao.getUserStatisticsInfo();</span><br><span class=\"line\">\t\t\tJSONObject jsonObject = JSONObject.fromObject(statisticsInfo);</span><br><span class=\"line\">\t\t\tout.print(jsonObject.toString());</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"comment\">// request all user info</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (id == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">\t\t\tList&lt;User&gt; users = userDao.getAllUsers();</span><br><span class=\"line\">\t\t\tJSONArray jsonObject = JSONArray.fromObject(users);</span><br><span class=\"line\">\t\t\tout.print(jsonObject.toString());</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"comment\">// request a single user info</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (id != -<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">\t\t\tUser user = userDao.getUserById(id);</span><br><span class=\"line\">\t\t\tJSONObject jsonObject = JSONObject.fromObject(user);</span><br><span class=\"line\">\t\t\tout.print(jsonObject.toString());</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@see</span> HttpServlet#doPost(HttpServletRequest request, HttpServletResponse</span></span><br><span class=\"line\"><span class=\"comment\">\t *      response)</span></span><br><span class=\"line\"><span class=\"comment\">\t */</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">doPost</span><span class=\"params\">(HttpServletRequest request,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t\t\tHttpServletResponse response)</span> <span class=\"keyword\">throws</span> ServletException, IOException </span>&#123;</span><br><span class=\"line\">\t\tresponse.setContentType(<span class=\"string\">\"application/json\"</span>);</span><br><span class=\"line\">\t\tresponse.addHeader(<span class=\"string\">\"Access-Control-Allow-Origin\"</span>, <span class=\"string\">\"*\"</span>);</span><br><span class=\"line\">\t\tPrintWriter out = response.getWriter();</span><br><span class=\"line\">\t\tString json = getBody(request);</span><br><span class=\"line\">\t\tJSONObject jsonObject = JSONObject.fromObject(json);</span><br><span class=\"line\">\t\tUser user = (User) JSONObject.toBean(jsonObject, User.class);</span><br><span class=\"line\">\t\t<span class=\"keyword\">int</span> id = userDao.addUser(user);</span><br><span class=\"line\">\t\tUser insertedUser = userDao.getUserById(id);</span><br><span class=\"line\">\t\tJSONObject userJson = JSONObject.fromObject(insertedUser);</span><br><span class=\"line\">\t\tout.print(userJson.toString());</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@see</span> HttpServlet#doPut(HttpServletRequest, HttpServletResponse)</span></span><br><span class=\"line\"><span class=\"comment\">\t */</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">doPut</span><span class=\"params\">(HttpServletRequest request,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t\t\tHttpServletResponse response)</span> <span class=\"keyword\">throws</span> ServletException, IOException </span>&#123;</span><br><span class=\"line\">\t\tresponse.setContentType(<span class=\"string\">\"application/json\"</span>);</span><br><span class=\"line\">\t\tresponse.addHeader(<span class=\"string\">\"Access-Control-Allow-Origin\"</span>, <span class=\"string\">\"*\"</span>);</span><br><span class=\"line\">\t\tPrintWriter out = response.getWriter();</span><br><span class=\"line\">\t\tString json = getBody(request);</span><br><span class=\"line\">\t\tJSONObject jsonObject = JSONObject.fromObject(json);</span><br><span class=\"line\">\t\tUser user = (User) JSONObject.toBean(jsonObject, User.class);</span><br><span class=\"line\">\t\tuserDao.updateUser(user);</span><br><span class=\"line\">\t\tUser insertedUser = userDao.getUserById(user.getId());</span><br><span class=\"line\">\t\tJSONObject userJson = JSONObject.fromObject(insertedUser);</span><br><span class=\"line\">\t\tout.print(userJson.toString());</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t * <span class=\"doctag\">@see</span> HttpServlet#doDelete(HttpServletRequest, HttpServletResponse)</span></span><br><span class=\"line\"><span class=\"comment\">\t */</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">doDelete</span><span class=\"params\">(HttpServletRequest request,</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"params\">\t\t\tHttpServletResponse response)</span> <span class=\"keyword\">throws</span> ServletException, IOException </span>&#123;</span><br><span class=\"line\">\t\tresponse.setContentType(<span class=\"string\">\"application/json\"</span>);</span><br><span class=\"line\">\t\tresponse.addHeader(<span class=\"string\">\"Access-Control-Allow-Origin\"</span>, <span class=\"string\">\"*\"</span>);</span><br><span class=\"line\">\t\tPrintWriter out = response.getWriter();</span><br><span class=\"line\">\t\t<span class=\"keyword\">int</span> id = isSingleUserInfoRequest(request);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (id &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">\t\t\tuserDao.deleteUser(id);</span><br><span class=\"line\">\t\t\tout.print(<span class=\"string\">\"&#123;\\\"msg\\\":\\\"successful\\\"&#125;\"</span>);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"meta\">@Override</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">protected</span> <span class=\"keyword\">void</span> <span class=\"title\">doOptions</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response)</span></span></span><br><span class=\"line\"><span class=\"function\">\t\t\t<span class=\"keyword\">throws</span> ServletException, IOException </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// http://stackoverflow.com/questions/1099787/jquery-ajax-post-sending-options-as-request-method-in-firefox</span></span><br><span class=\"line\">\t\tresponse.addHeader(<span class=\"string\">\"Access-Control-Allow-Origin\"</span>, <span class=\"string\">\"*\"</span>);</span><br><span class=\"line\">\t\tresponse.addHeader(<span class=\"string\">\"Access-Control-Allow-Methods\"</span>, <span class=\"string\">\"GET, POST, PUT, DELETE, OPTIONS\"</span>);</span><br><span class=\"line\">\t\tresponse.addHeader(<span class=\"string\">\"Access-Control-Max-Age\"</span>, <span class=\"string\">\"86400\"</span>);</span><br><span class=\"line\">\t\tresponse.addHeader(<span class=\"string\">\"Access-Control-Allow-Headers\"</span>, <span class=\"string\">\"User-Agent,Origin,Cache-Control,Content-Type,x-zd,Date,Server,withCredentials\"</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">super</span>.doOptions(request, response);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>前端ajax请求中添加如下</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$.ajaxPrefilter( <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> options, originalOptions, jqXHR </span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// ...</span></span><br><span class=\"line\">  options.crossDomain = <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>参考资料</p>\n<ol>\n<li><a href=\"http://stackoverflow.com/questions/20035101/no-access-control-allow-origin-header-is-present-on-the-requested-resource\" target=\"_blank\" rel=\"noopener\">no-access-control-allow-origin-header-is-present-on-the-requested-resource</a></li>\n<li><a href=\"http://stackoverflow.com/questions/20433655/no-access-control-allow-origin-header-is-present-on-the-requested-resource-or\" target=\"_blank\" rel=\"noopener\">no-access-control-allow-origin-header-is-present-on-the-requested-resource-or</a></li>\n<li><a href=\"http://stackoverflow.com/questions/1099787/jquery-ajax-post-sending-options-as-request-method-in-firefox\" target=\"_blank\" rel=\"noopener\">jquery-ajax-post-sending-options-as-request-method-in-firefox</a></li>\n<li><a href=\"http://stackoverflow.com/questions/12320467/jquery-cors-content-type-options\" target=\"_blank\" rel=\"noopener\">jquery-cors-content-type-options</a></li>\n<li><a href=\"http://stackoverflow.com/questions/1743845/jquery-i-get-options-request-instead-of-get\" target=\"_blank\" rel=\"noopener\">jquery-i-get-options-request-instead-of-get</a></li>\n<li><a href=\"http://stackoverflow.com/questions/16303591/disable-preflight-option-request-when-sending-a-cross-domain-request-with-custom\" target=\"_blank\" rel=\"noopener\">disable-preflight-option-request-when-sending-a-cross-domain-request-with-custom</a></li>\n</ol>\n"}