{"summary":"<p>hierarchyviewer对于Android开发是一个非常实用方便的工具，可惜不能在真机上（使用官方的BUILDTYPE为user的ROM）使用。</p>\n<a id=\"more\"></a>\n<p><a href=\"http://blog.apkudo.com/2012/07/26/enabling-hierarchyviewer-on-rooted-android-devices/\" target=\"_blank\" rel=\"noopener\">这里</a>的方法以前也提到过，不过<a href=\"http://code.google.com/p/smali/\" target=\"_blank\" rel=\"noopener\">smali/baksmali </a>不适用于Android 5.0了（baksmali执行时会提示”services.odex is not an apk, dex file or odex file”错误），所以这里使用另一种方法，修改/default.prop文件，但也不能直接修改，这个文件每次系统重启都会用boot.img中ramdisk的default.prop覆盖，即使root了直接修改，在shell中通过getprop “ro.debuggable”查看也不会生效，所以只能去修改boot.img</p>\n<!--more-->\n<p>修改的方法/工具在网上有很多，Windows上推荐使用Android Image Kitchen，使用方式也很简单，把boot.img拖拽到unpackimg.bat就可解压，然后修改ramdisk中的default.prop，修改”ro.secure”/“ro.debuggable”(参考<a href=\"https://android.googlesource.com/platform/frameworks/base/+/master/services/core/java/com/android/server/wm/WindowManagerService.java\" target=\"_blank\" rel=\"noopener\">WindowManagerService</a>中的isSystemSecure)值分别如下</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ro.secure=0</span><br><span class=\"line\">ro.debuggable=1</span><br></pre></td></tr></table></figure>\n<p>再次双击运行repackimg.bat就可以生成新的修改过的boot.img（名字是image-new.img），然后adb reboot bootloader重启到bootloader模式，使用fastboot flash boot image-new.img刷入新的boot分区就可以生效，这时hierarchyviewer就可以使用</p>\n<p>Linux（以Ubuntu为例），可以使用abootimg这个工具，参考<a href=\"http://k.japko.eu/boot-img-manipulation.html\" target=\"_blank\" rel=\"noopener\">Android boot.img manipulation</a>这篇文章，不过在make时会提示”blkid/blkid.h”头文件找不到，安装libblkid-dev即可</p>\n<p>参考资料</p>\n<ol>\n<li><a href=\"http://forum.xda-developers.com/showthread.php?t=2073775\" target=\"_blank\" rel=\"noopener\">Android Image Kitchen – Unpack/Repack Kernel+Recovery Images, and Edit the ramdisk.</a></li>\n<li><a href=\"http://k.japko.eu/boot-img-manipulation.html\" target=\"_blank\" rel=\"noopener\">Android boot.img manipulation</a></li>\n<li><a href=\"http://forum.xda-developers.com/showthread.php?t=1794203\" target=\"_blank\" rel=\"noopener\">Make your android device True Root!</a></li>\n<li><a href=\"http://manpages.ubuntu.com/manpages/trusty/man3/libblkid.3.html\" target=\"_blank\" rel=\"noopener\">libblkid</a></li>\n</ol>\n"}