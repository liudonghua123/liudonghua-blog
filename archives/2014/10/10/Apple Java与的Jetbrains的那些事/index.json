{"summary":"<p>最近升级了yosemite系统导致原来安装的jetbrains系列开发工具（如Intellj、PhpStorm、RubyMine、PyCharm、WebStorm）无法使用，直接闪退，没有任何错误信息，但查看本机安装的JDK已经有JDK7和JDK8了，JAVA_HOME环境变量等都是配置正确的，Eclipse也是可以使用的，后来运行这个才发现问题</p>\n<a id=\"more\"></a>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/Applications/PhpStorm.app/Contents/MacOS/phpstorm</span><br><span class=\"line\">[JavaAppLauncher Error] CFBundleCopyResourceURL() failed loading MRJApp.properties file</span><br><span class=\"line\">[JavaAppLauncher Error] CFBundleCopyResourceURL() failed <span class=\"keyword\">while</span> getting Resource/Java directory</span><br><span class=\"line\">JavaVM: Failed to load JVM: /Library/Java/JavaVirtualMachines/jdk1.7.0_45.jdk/Contents/Home/bundle/Libraries/libserver.dylib</span><br><span class=\"line\">JavaVM: Failed to load JVM: /Library/Java/JavaVirtualMachines/jdk1.7.0_45.jdk/Contents/Home/bundle/Libraries/libserver.dylib</span><br><span class=\"line\">JavaVM FATAL: Failed to load the jvm library.</span><br><span class=\"line\">[JavaAppLauncher Error] JNI_CreateJavaVM() failed, error: -1</span><br></pre></td></tr></table></figure>\n<p>查看phpstorm的<a href=\"https://www.jetbrains.com/phpstorm/webhelp/system-requirements-and-installation.html\" target=\"_blank\" rel=\"noopener\">System Requirements and Installation</a>才发现Mac下只支持Apple的JDK6，不过<a href=\"https://intellij-support.jetbrains.com/entries/23455956-Selecting-the-JDK-version-the-IDE-will-run-under\" target=\"_blank\" rel=\"noopener\">这里</a>提到可以尝试一下JDK7的方法</p>\n<p>知道了问题所在就方便解决了<br>首先安装最新的Apple JDK <a href=\"http://support.apple.com/kb/DL1572\" target=\"_blank\" rel=\"noopener\">JavaForOSX2014-001.dmg\n</a>然后设置系统默认的JDK版本<br>这里的关键是/usr/libexec/java_home</p>\n<p>未安装apple的JDK，只安装Oracle JDK（Oracle知道JDK7才开始提供Mac版本，从此Apple JDK就不再开发新版本了）时/usr/libexec/java_home是一个文件，执行</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/usr/libexec/java_home -V</span><br><span class=\"line\">Matching Java Virtual Machines (2):</span><br><span class=\"line\">1. 8.0_20, x86_64: <span class=\"string\">\"Java SE 8\"</span> /Library/Java/JavaVirtualMachines/jdk1.8.0_20.jdk/Contents/Home</span><br><span class=\"line\">1. 7.0_45, x86_64: <span class=\"string\">\"Java SE 7\"</span> /Library/Java/JavaVirtualMachines/jdk1.7.0_45.jdk/Contents/Home</span><br></pre></td></tr></table></figure>\n<p>安装apple的JDK后/usr/libexec/java_home是一个软链接，指向/System/Library/Frameworks/JavaVM.framework/Versions/Current/Commands/java_home</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/System/Library/Frameworks/JavaVM.framework/Versions/Current/Commands/java_home -V</span><br><span class=\"line\">Matching Java Virtual Machines (4):</span><br><span class=\"line\">1. 8.0_20, x86_64: <span class=\"string\">\"Java SE 8\"</span> /Library/Java/JavaVirtualMachines/jdk1.8.0_20.jdk/Contents/Home</span><br><span class=\"line\">1. 7.0_45, x86_64: <span class=\"string\">\"Java SE 7\"</span> /Library/Java/JavaVirtualMachines/jdk1.7.0_45.jdk/Contents/Home</span><br><span class=\"line\">1. 6.0_65-b14-466.1, x86_64: <span class=\"string\">\"Java SE 6\"</span> /System/Library/Java/JavaVirtualMachines/1.6.0.jdk/Contents/Home</span><br><span class=\"line\">1. 6.0_65-b14-466.1, i386: <span class=\"string\">\"Java SE 6\"</span> /System/Library/Java/JavaVirtualMachines/1.6.0.jdk/Contents/Home</span><br></pre></td></tr></table></figure>\n<p>由此可知Mac下Apple JDK安装在/System/Library/Java/JavaVirtualMachines/下，Oracle JDK安装在/Library/Java/JavaVirtualMachines/</p>\n<p>值得注意的还有/System/Library/Frameworks/JavaVM.framework/Versions/列出了当前所有的JDK版本，由于我是现有Oracle JDK在安装Apple JDK的，所以这里没有1.7、1.8</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ll /System/Library/Frameworks/JavaVM.framework/Versions/</span><br><span class=\"line\"></span><br><span class=\"line\">total 64</span><br><span class=\"line\">drwxr-xr-x 11 root wheel 374 10 10 08:17 .</span><br><span class=\"line\">drwxr-xr-x 12 root wheel 408 10 10 08:17 ..</span><br><span class=\"line\">lrwxr-xr-x 1 root wheel 10 10 10 08:17 1.4 -&gt; CurrentJDK</span><br><span class=\"line\">lrwxr-xr-x 1 root wheel 10 10 10 08:17 1.4.2 -&gt; CurrentJDK</span><br><span class=\"line\">lrwxr-xr-x 1 root wheel 10 10 10 08:17 1.5 -&gt; CurrentJDK</span><br><span class=\"line\">lrwxr-xr-x 1 root wheel 10 10 10 08:17 1.5.0 -&gt; CurrentJDK</span><br><span class=\"line\">lrwxr-xr-x 1 root wheel 10 10 10 08:17 1.6 -&gt; CurrentJDK</span><br><span class=\"line\">lrwxr-xr-x 1 root wheel 10 10 10 08:17 1.6.0 -&gt; CurrentJDK</span><br><span class=\"line\">drwxr-xr-x 8 root wheel 272 10 10 08:17 A</span><br><span class=\"line\">lrwxr-xr-x 1 root wheel 1 10 10 08:17 Current -&gt; A</span><br><span class=\"line\">lrwxr-xr-x 1 root wheel 59 10 10 08:17 CurrentJDK -&gt; /System/Library/Java/JavaVirtualMachines/1.6.0.jdk/Contents</span><br></pre></td></tr></table></figure>\n<p>配置系统默认的JDK版本方法如下备份java_home_bak，修改java_home内容为echo <code>/usr/libexec/java_home_bak -v 1.6*</code></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo mv /usr/libexec/java_home /usr/libexec/java_home_bak</span><br><span class=\"line\">sudo vi /usr/libexec/java_home</span><br><span class=\"line\"><span class=\"built_in\">echo</span> `/usr/libexec/java_home_bak -v 1.6*`</span><br><span class=\"line\">sudo chmod a+x /usr/libexec/java_home</span><br></pre></td></tr></table></figure>\n<p>这时执行<br>/usr/libexec/java_home返回<br>/System/Library/Java/JavaVirtualMachines/1.6.0.jdk/Contents/Home</p>\n<p>至此jetbrains系列工具就可以使用了，不需要重启或注销，这似乎可以看出jetbrains产品只依赖于/usr/libexec/java_home，JAVA_HOME可以指向其他版本的JDK</p>\n<p>如果需要在终端中临时改变JDK版本，可以添加下列Bash脚本到~/.bash_profile中</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"function\"><span class=\"title\">setjdk</span></span>() &#123;</span><br><span class=\"line\"><span class=\"keyword\">if</span> [ <span class=\"variable\">$#</span> -ne 0 ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">removeFromPath <span class=\"string\">'/System/Library/Frameworks/JavaVM.framework/Home/bin'</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> [ -n <span class=\"string\">\"<span class=\"variable\">$&#123;JAVA_HOME+x&#125;</span>\"</span> ]; <span class=\"keyword\">then</span></span><br><span class=\"line\">removeFromPath <span class=\"variable\">$JAVA_HOME</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\"><span class=\"built_in\">export</span> JAVA_HOME=`/usr/libexec/java_home_bak -v <span class=\"variable\">$@</span>`</span><br><span class=\"line\"><span class=\"built_in\">export</span> PATH=<span class=\"variable\">$JAVA_HOME</span>/bin:<span class=\"variable\">$PATH</span></span><br><span class=\"line\"><span class=\"keyword\">fi</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"function\"><span class=\"title\">removeFromPath</span></span>() &#123;</span><br><span class=\"line\"><span class=\"built_in\">export</span> PATH=$(<span class=\"built_in\">echo</span> <span class=\"variable\">$PATH</span> | sed -E -e <span class=\"string\">\"s;:<span class=\"variable\">$1</span>;;\"</span> -e <span class=\"string\">\"s;<span class=\"variable\">$1</span>:?;;\"</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>以后切换时就只需要setjdk 1.6或setjdk 1.7等等的了</p>\n"}